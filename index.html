<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <style>
      html, body, webview {
        height: 100%;
      }

      body {
        overflow: hidden;
        -webkit-app-region: no-drag;
        /*padding: 5px;*/
        margin: 0;
        padding: 0;
      }

      #draggable {
        -webkit-app-region: drag;
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        bottom: 40px;
        cursor: move;
      }
    </style>
  </head>
  <body>
    <!--<div id="controls">
      <button onclick="changeRatio(16 / 9)">16:9</button>
    </div>-->

    <div id="draggable"></div>

    <webview src="https://www.youtube.com/watch?v=N3rhpP741Gc" 
    style="display:inline-flex; width:100%; height:100%" 
    useragent="Mozilla/5.0 (Linux; Android 5.1.1; Nexus 5 Build/LMY48B; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/43.0.2357.65 Mobile Safari/537.36"
    preload="./preload.js"></webview>
  </body>

  <script>
    const { ipcRenderer } = require('electron');
    const _ = require('lodash');

    const browserWindow = require('electron').remote.getCurrentWindow();
    const webview = document.querySelector('webview');

    webview.addEventListener('dom-ready', () => {
      // webview.openDevTools();
      webview.executeJavaScript(`
        const player = document.querySelector('[aria-label="YouTube-Videoplayer"]')
        player.click();
        const video = document.querySelector('video');
        video.style = '';
        body.innerHTML = '';
        body.appendChild(video);
        video.onloadedmetadata = () => {
          sendVideoRatio(video.videoWidth / video.videoHeight);
        }
      `)
    });

    webview.addEventListener('ipc-message', (event) => {
      const channel = event.channel;
      if (channel.event === 'videoRatio') {
        ipcRenderer.send('message', channel);
        ipcRenderer.send('message', { event: 'resize' });
      }
    });

    browserWindow.on('resize', _.throttle(() => {
      ipcRenderer.send('message', { event: 'resize' }, 1000);
    }));
  </script>
</html>
